#!/bin/bash

do_update_alternatives(){
    # skip update if program doesn't exist
    command -v update-alternatives >/dev/null || return 0
    # Update the /opt/rocm symlink
    if [[ ${ID_LIKE:-$ID} == "debian" ]] || [[ "$RPM_INSTALL_PREFIX0" == "/opt/rocm-"* ]] ; then
        update-alternatives --remove "rocm" "/opt/rocm-%PKG_FULL_VERSION%"
    fi

    if [[ ${ID_LIKE:-$ID} == "debian" ]] ; then
        update-alternatives --remove "rocmmod%PKG_FULL_VERSION%" "/opt/rocm-%PKG_FULL_VERSION%/lib/rocmmod"|| true
    else
        update-alternatives --remove "rocmmod%PKG_FULL_VERSION%" "$RPM_INSTALL_PREFIX0/lib/rocmmod"|| true
    fi
}

if [ -e /etc/os-release ] && source /etc/os-release && [[ ${ID_LIKE:-$ID} == "debian" ]]
then
   case "$1" in
       (remove | upgrade)
           do_update_alternatives
       ;;
       (purge)
       ;;
       (*)
           exit 0
       ;;
   esac
else
     do_update_alternatives
fi
